{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style_historial.css') }}">
{% endblock %}

{% block content %}

<h1 class="block-effect" style="--td:0.3s">
    <div class="block-reveal" style="--bc: #2b3034; --d: 0.5s">Historial</div>
</h1>
{% block breadcrumb %}
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Inicio</a></li>
            <li class="breadcrumb-item active" aria-current="page">Historial</li>
        </ol>
    </nav>
{% endblock %}
<div class="head">
    <form method="get" action="{{ url_for('historial') }}" id="filtro-form">
        <div class="doble-filtro-sistema">
            <div>
                <div class="filtro">
                    <select class="form-select form-select-bg" name="categoria" aria-label="Selecciona una Categoría">
                        <option value="">Selecciona una Categoría</option>
                        {% for categoria in categorias %}
                        <option value="{{ categoria['id_categoria'] }}" {% if
                            request.args.get('categoria')==categoria['id_categoria'] %} selected {% endif %}>
                            {{ categoria['nombre_categoria'] }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <button class="btn btn-success" type="button" id="filtro-boton">Buscar</button>
        </div>
    </form>
</div>

<script>
    document.getElementById('filtro-boton').addEventListener('click', function () {
        document.getElementById('filtro-form').submit();
    });
</script>

<h3>
    {% if categoria_nombre %}
    Categoria {{ categoria_nombre['nombre_categoria'] }}
    {% endif %}
</h3>

{% if historial_data %}
<table class="table table-hover">
    </thead>
    <tbody>
        {% for registro in historial_data %}
        <tr>
            <td>{{ registro['usuario_historial'] }}</td>
            <td>{{ registro['descripcion'] }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>



<nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">
        {% if page > 1 %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('historial', page=page-1, categoria=request.args.get('categoria')) }}"
                aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        {% endif %}

        {% if start_page > 1 %}
        <li class="page-item"><a class="page-link"
                href="{{ url_for('historial', page=1, categoria=request.args.get('categoria')) }}">1</a></li>
        {% if start_page > 2 %}
        <li class="page-item disabled"><span class="page-link">...</span></li>
        {% endif %}
        {% endif %}

        {% for p in range(start_page, end_page + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
            <a class="page-link" href="{{ url_for('historial', page=p, categoria=request.args.get('categoria')) }}">{{ p
                }}</a>
        </li>
        {% endfor %}

        {% if end_page < total_pages %} {% if end_page < total_pages - 1 %} <li class="page-item disabled"><span
                class="page-link">...</span></li>
            {% endif %}
            <li class="page-item"><a class="page-link"
                    href="{{ url_for('historial', page=total_pages, categoria=request.args.get('categoria')) }}">{{
                    total_pages }}</a></li>
            {% endif %}

            {% if page < total_pages %} <li class="page-item">
                <a class="page-link"
                    href="{{ url_for('historial', page=page+1, categoria=request.args.get('categoria')) }}"
                    aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
                </li>
                {% endif %}
    </ul>
    <br>
</nav>



{% else %}
<tr>
    <div class="alert alert-danger" role="alert">
        No existen registros.
    </div>
</tr>
{% endif %}


{% endblock %}